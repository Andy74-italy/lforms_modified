<div ng-controller="PanelTableCtrl" ng-keypress="handleNavigationKeyEvent($event)">
  <form name="panel" novalidate>
    <div class="panelGroup fieldGroup" ng-if="lfData" >
      <div ng-include="'form-header.html'"></div>

      <h3 class="groupHeader">
        <span>{{lfData.name}}</span>
        <span ng-if="formConfig.showQuestionCode">
          <a href="http://s.details.loinc.org/LOINC/{{ lfData.code }}.html" target="_blank">[{{ lfData.code }}]</a></span>
      </h3>
      <div class="fieldExpColDiv">
        <table cellspacing="0" cellpadding="0" class="fieldsTable">
          <colgroup>
            <col ng-repeat="item in ::lfData.templateOption.obrItems"
                 ng-style="{'width': '{{::item.formatting.width}}',
                            'min-width': '{{::item.formatting['min-width']}}'}">
          </colgroup>
          <thead>
          <tr>
            <th class="fieldsTableHeader"
             ng-repeat="item in ::lfData.templateOption.obrItems"><label
             for="obr_{{::item.question}}">{{::item.question}}</label></th>
          </tr>
          </thead>
          <tbody>
          <tr class="repeatingLine">
            <td class="rowEditText hasTooltip" ng-repeat="item in lfData.templateOption.obrItems"
                ng-switch on="item.dataType">
              <ng-form name="innerForm">
                  <div class="cellData tooltipContainer">
                    <span class="tooltipContent" ng-include="'validation.html'"></span>  <!-- validation error messages -->
                    <input ng-switch-when="CWE" name="{{::item.question}}"
                           ng-required="::isAnswerRequired(item)" placeholder="Select or type a value"
                           ng-model-options="{updateOn: 'change'}" ng-model="item._value"
                           phr-autocomplete="::phrAutocompOpt(item)" ng-readonly="::isReadOnly(item)"
                           id="obr_{{::item.question}}">
                    <input ng-switch-when="DT" name="{{::item.question}}"
                           ng-required="::isAnswerRequired(item)"
                           ng-model-options="{ updateOn: 'default' }"
                           ng-model="item._value" lf-date="::dateOptions"
                           placeholder="MM/DD/YYYY" ng-readonly="::isReadOnly(item)"
                           id="obr_{{::item.question}}">
                    <input ng-switch-default name="{{::item.question}}"
                           ng-required="::isAnswerRequired(item)"
                           ng-model-options="{ updateOn: 'default' }"
                           ng-model="item._value" placeholder="Type a value"
                           ng-readonly="::isReadOnly(item)"
                           id="obr_{{::item.question}}">
                  </div>
              </ng-form>
            </td>
          </tr>
          <tr class="embeddedRow">
            <td colspan="5">
              <div>
                <table cellspacing="0" cellpadding="0" class="fieldsTable">
                  <colgroup>
                    <col ng-repeat="obxCol in ::lfData.templateOption.obxTableColumns"
                         ng-style="{'width': '{{::obxCol.formatting.width}}',
                                    'min-width': '{{::obxCol.formatting['min-width']}}'}">
                  </colgroup>
                  <thead>
                  <tr>
                    <th class="fieldsTableHeader" ng-repeat="obxCol in ::lfData.templateOption.obxTableColumns"
                     id="th_{{obxCol.name}}">{{::obxCol.name}}</th>
                  </tr>
                  </thead>
                  <tbody id="obx_table" class="fieldExpColDiv">
                  <tr style="width: 99%"
                      class="repeatingLine {{ getSkipLogicTargetClass(item) }} {{getRowClass(item)}} {{getActiveRowClass($index)}}"
                      ng-repeat-start="item in lfData.items track by $id(item)" ng-click="setActiveRow($index)">
                    <td class="name has_treeline">
                      <table class="t-treeline-field" >
                        <tr>
                          <td class="t-treeline " ng-class="getTreeLevelClass(5, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getTreeLevelClass(4, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getTreeLevelClass(3, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getTreeLevelClass(2, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getTreeLevelClass(1, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getTreeLevelClass(0, $index) "> &nbsp; </td>
                          <td>
                            <div class="name_label">
                              <span ng-show="::isRepeatable(item)" class="sn">{{::getRepeatingSN(item) }}</span>
                              <span><label for="{{::item._elementId}}">{{::item.question}}</label></span>
                              <span ng-show="formConfig.showQuestionCode">
                                <a href="http://s.details.loinc.org/LOINC/{{ item.questionCode }}.html"
                                   target="_blank">[{{ item.questionCode }}]</a></span>
                              <span ng-show="formConfig.showCodingInstruction"
                                    class="prompt">{{ ::getCodingInstructions(item) }}</span>
                              <button ng-show="!formConfig.showCodingInstruction" ng-if="::hasCodingInstructions(item)"
                                      class="help-button" bs-popover="::item.codingInstructions"
                                      data-auto-close="true" data-placement="right"  title="Instruction">?</button>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td class="button-col">
                      <button ng-if="!hasOneRepeatingItem(item)" class="float-button"
                              ng-click="removeOneRepeatingItem(item)"
                              title="Remove this '{{ ::item.question }}'">-</button>
                    </td>
                    <td ng-switch on="::getFieldType(item)" class="hasTooltip">
                      <ng-form name="innerForm2">
                        <div class="cellData tooltipContainer">
                          <span class="tooltipContent" ng-include="'validation.html'"></span>  <!-- validation error messages -->
                          <span ng-switch-when="" > </span>
                          <input ng-switch-when="CNE-1" name="{{::item.question +'_'+ $id}}"
                                 ng-required="::isAnswerRequired(item)" ng-model-options="{updateOn: 'change'}"
                                 ng-model="item._value" phr-autocomplete="::phrAutocompOpt(item)"
                                 ng-readonly="::isReadOnly(item)" placeholder="Select one or more"
                                 id="{{::item._elementId}}">
                          <input ng-switch-when="CWE-1" name="{{::item.question +'_'+ $id}}"
                                 ng-required="::isAnswerRequired(item)" ng-model-options="{updateOn: 'change'}"
                                 ng-model="item._value" phr-autocomplete="::phrAutocompOpt(item)"
                                 ng-readonly="::isReadOnly(item)" placeholder="Select one or more or type a value"
                                 id="{{::item._elementId}}">
                          <input ng-switch-when="REAL1" name="{{::item.question}}" type="number"
                                 ng-required="::isAnswerRequired(item)" ng-model-options="{ updateOn: 'default' }"
                                 ng-model="item._value" placeholder="Type a value"
                                 ng-readonly="::isReadOnly(item )" id="{{::item._elementId}}">
                          <input ng-switch-when="INT1" name="{{::item.question}}" type="number"
                                 ng-required="::isAnswerRequired(item)" ng-model-options="{ updateOn: 'default' }"
                                 ng-model="item._value" placeholder="Type a value"
                                 ng-readonly="::isReadOnly(item )" id="{{::item._elementId}}">
                          <input ng-switch-when="CNE1" name="{{::item.question + '_'+ $id}}"
                                 ng-required="::isAnswerRequired(item)"
                                 placeholder="Select one" ng-model-options="{updateOn: 'change'}"
                                 ng-model="item._value" phr-autocomplete="::phrAutocompOpt(item)"
                                 ng-readonly="::isReadOnly(item)" id="{{::item._elementId}}">
                          <input ng-switch-when="CWE1" name="{{::item.question + '_'+ $id}}"
                                 ng-required="::isAnswerRequired(item)"
                                 placeholder="Select one  or type a value" ng-model-options="{updateOn: 'change'}"
                                 ng-model="item._value" phr-autocomplete="::phrAutocompOpt(item)"
                                 ng-readonly="::isReadOnly(item)" id="{{::item._elementId}}">
                          <input ng-switch-when="DT1" name="{{::item.question}}" ng-required="::isAnswerRequired(item)"
                                 ng-model-options="{ updateOn: 'default' }" ng-model="item._value"
                                 lf-date="::dateOptions" placeholder="MM/DD/YYYY" ng-readonly="::isReadOnly(item)"
                                 id="{{::item._elementId}}">
                          <input ng-switch-default name="{{::item.question}}" ng-required="::isAnswerRequired(item)"
                                 ng-model-options="{ updateOn: 'default' }" ng-model="item._value"
                                 placeholder="Type a value" ng-readonly="::isReadOnly(item)"
                                 id="{{::item._elementId}}">
                        </div>
                      </ng-form>
                    </td>
                    <td ng-switch on="::checkUnits(item)">
                      <input class="units" ng-switch-when="list" ng-model-options="{updateOn: 'change'}"
                             ng-model="item._unit" phr-autocomplete="phrUnitsAutocompOpt(item)"
                             placeholder="Select one" aria-labelledby="th_Units">
                      <span ng-switch-when="none" > </span>
                    </td>
                    <!--<td>{{item.range}}</td>-->
                  </tr>
                  <!-- extra question -->
                  <tr ng-if="needExtra(item)" style="width: 99%"
                      class="extra-row repeatingLine {{ getSkipLogicTargetClass(item) }} {{getRowClass(item)}}">
                    <td class="name has_treeline">
                      <table class="t-treeline-field" >
                        <tr>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(5, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(4, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(3, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(2, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(1, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(0, $index) "> &nbsp; </td>
                          <td>
                            <div class="name_label">
                              <span>&nbsp;</span>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td class="button-col"></td>
                    <td colspan="5" class="extra-field">
                      <input ng-model="item._valueOther" placeholder="Please specify" ng-readonly="::isReadOnly(item)">
                    </td>
                  </tr>
                  <!--a button row at the end of each repeating section-->
                  <tr ng-repeat-end ng-if="isLastItemInRepeatingItems($index)"
                      class="buttonRow repeatingLine {{ getSkipLogicTargetClass(item) }} {{getRowClass(item)}}" >
                    <td colspan="6" class="name has_treeline" >
                      <table class="t-treeline-field" >
                        <tr>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(5, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(4, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(3, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(2, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(1, $index) "> &nbsp; </td>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass(0, $index) "> &nbsp; </td>
                          <td>
                            <div class="name_label">
                              <button ng-repeat="repeatingItem in getParentRepeatingItemsOfLastItem($index)"
                                      class="float-button"  id="{{repeatingItem._elementId}}"
                                      ng-click="addOneRepeatingItem(repeatingItem)"
                                      title="Add another '{{ ::repeatingItem.question }}'">
                                Add another '{{::repeatingItem.question}}'</button>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </form>
  <button ng-click="onclick()">Click to debug Panel Controller</button>
</div>
