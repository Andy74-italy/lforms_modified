<div ng-controller="PanelTableCtrl" ng-keydown="handleNavigationKeyEventByTab($event)">
  <form class="lf-form" novalidate autocomplete="false">
    <div class="lf-form-view" ng-if="lfData" >
      <div ng-include="'form-header.html'"></div>

      <h3 class="lf-form-title">
        <span>{{lfData.name}}</span>
        <span ng-if="formConfig.showQuestionCode">
          <a href="http://s.details.loinc.org/LOINC/{{ lfData.code }}.html" target="_blank">[{{ lfData.code }}]</a></span>
      </h3>
      <div class="lf-form-body">
        <table cellspacing="0" cellpadding="0" class="lf-form-table">
          <colgroup>
            <col ng-repeat="item in ::lfData.templateOption.obrItems"
                 ng-style="{'width': '{{::item.formatting.width}}',
                            'min-width': '{{::item.formatting['min-width']}}'}">
          </colgroup>
          <thead>
          <tr>
            <th class="lf-form-table-header"
                ng-repeat="item in ::lfData.templateOption.obrItems"><label
              for="obr_{{::item.question}}">{{::item.question}}</label></th>
          </tr>
          </thead>
          <tbody>
          <tr class="lf-form-table-row">
            <td class="rowEditText hasTooltip" ng-repeat="item in lfData.templateOption.obrItems"
                ng-switch on="item.dataType">
              <ng-form name="innerForm">
                <div class="lf-form-item-data tooltipContainer">
                  <span class="tooltipContent" ng-include="'validation.html'"></span>  <!-- validation error messages -->
                  <input ng-switch-when="CWE" name="{{::item.question}}"
                         ng-required="::item._answerRequired" placeholder="Select or type a value"
                         ng-model="item.value"
                         autocomplete-lhc="::autocompLhcOpt(item)"
                         id="obr_{{::item.question}}">
                  <input ng-switch-when="DT" name="{{::item.question}}"
                         ng-required="::item._answerRequired"
                         ng-model="item.value" lf-date="::dateOptions"
                         placeholder="MM/DD/YYYY"
                         id="obr_{{::item.question}}">
                  <input ng-switch-default name="{{::item.question}}"
                         ng-required="::item._answerRequired"
                         ng-model="item.value" placeholder="Type a value"
                         id="obr_{{::item.question}}">
                </div>
              </ng-form>
            </td>
          </tr>
          <tr class="lf-form-table-row lf-form-body">
            <td colspan="5">
              <div>
                <table cellspacing="0" cellpadding="0" class="lf-form-table">
                  <colgroup>
                    <col ng-repeat="obxCol in ::lfData.templateOption.obxTableColumns"
                         ng-style="{'width': '{{::obxCol.formatting.width}}',
                                    'min-width': '{{::obxCol.formatting['min-width']}}'}">
                  </colgroup>
                  <thead>
                  <tr>
                    <th class="lf-form-table-header" ng-repeat="obxCol in ::lfData.templateOption.obxTableColumns"
                        id="th_{{obxCol.name}}">{{::obxCol.name}}</th>
                  </tr>
                  </thead>
                  <tbody class="">
                  <tr class="data-row has-ng-animate lf-form-table-row {{getRowClass(item)}} {{getSkipLogicClass(item)}} {{getActiveRowClass(item)}}" ng-if="targetShown(item)"
                      ng-repeat-start="item in lfData.itemList " ng-click="setActiveRow(item)">
                    <td ng-if="::!item._inHorizontalTable" class="name has-treeline">
                      <table class="t-treeline-field" >
                        <tr>
                          <td class="t-treeline " ng-class="getTreeLevelClass($index, item._lastSiblingList)" ng-repeat="lastStatus in item._lastSiblingList track by $index"> &nbsp; </td>
                          <td>
                            <div class="name-label">
                              <span ng-show="::item._questionRepeatable" class="sn">{{::getRepeatingSN(item) }}</span>
                              <span><label for="{{::item._elementId}}">{{::item.question}}</label></span>
                              <span ng-show="formConfig.showQuestionCode">
                                <a href="http://s.details.loinc.org/LOINC/{{ item.questionCode }}.html"
                                   target="_blank">[{{ item.questionCode }}]</a></span>
                              <span ng-show="formConfig.showCodingInstruction"
                                    class="prompt">{{ ::getCodingInstructions(item) }}</span>
                              <button ng-show="!formConfig.showCodingInstruction" ng-if="::hasCodingInstructions(item)"
                                      class="help-button" bs-popover="::item.codingInstructions"
                                      data-auto-close="true" data-placement="right"  title="Instruction">?</button>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td ng-if="::!item._inHorizontalTable" class="button-col">
                      <button ng-if="!hasOneRepeatingItem(item)" class="float-button"
                              ng-click="removeOneRepeatingItem(item)" id="del-{{item._elementId}}"
                              title="Remove this '{{ ::item.question }}'">-</button>
                    </td>
                    <td ng-if="::!item._inHorizontalTable" ng-switch on="item.dataType" class="hasTooltip">
                      <ng-form name="innerForm2">
                        <div class="lf-form-item-data tooltipContainer">
                          <span class="tooltipContent" ng-include="'validation.html'"></span>  <!-- validation error messages -->
                          <span ng-switch-when="" id="{{::item._elementId}}"> </span>
                          <input ng-switch-when="CNE" name="{{::item.question +'_'+ $id}}"
                                 ng-required="::item._answerRequired"
                                 ng-model="item.value" autocomplete-lhc="::autocompLhcOpt(item)"
                                 ng-readonly="::item._readOnly" placeholder="{{::item._toolTip}}"
                                 id="{{::item._elementId}}">
                          <input ng-switch-when="CWE" name="{{::item.question +'_'+ $id}}"
                                 ng-required="::item._answerRequired"
                                 ng-model="item.value" autocomplete-lhc="::autocompLhcOpt(item)"
                                 ng-readonly="::item._readOnly" placeholder="{{::item._toolTip}}"
                                 id="{{::item._elementId}}">
                          <input ng-switch-when="REAL" name="{{::item.question}}" type="number"
                                 ng-required="::item._answerRequired"
                                 ng-model="item.value" placeholder="{{::item._toolTip}}"
                                 ng-readonly="::item._readOnly" id="{{::item._elementId}}">
                          <input ng-switch-when="INT" name="{{::item.question}}" type="number"
                                 ng-required="::item._answerRequired"
                                 ng-model="item.value" placeholder="{{::item._toolTip}}"
                                 ng-readonly="::item._readOnly" id="{{::item._elementId}}">
                          <input ng-switch-when="DT" name="{{::item.question}}" ng-required="::item._answerRequired"
                                 ng-model="item.value" lf-date="::dateOptions" placeholder="{{::item._toolTip}}"
                                 ng-readonly="::item._readOnly" id="{{::item._elementId}}">
                          <input ng-switch-default name="{{::item.question}}" ng-required="::item._answerRequired"
                                 ng-model="item.value" placeholder="{{::item._toolTip}}" ng-readonly="::item._readOnly"
                                 ng-value="runFormula(item)" id="{{::item._elementId}}">
                        </div>
                      </ng-form>
                    </td>
                    <td ng-if="::!item._inHorizontalTable" ng-switch on="::checkUnits(item)">
                      <input class="units" ng-switch-when="list"
                             ng-model="item.unit" autocomplete-lhc="::unitsAutocompLhcOpt(item)"
                             placeholder="Select one" aria-labelledby="th_Units">
                      <span ng-switch-when="none" > </span>
                    </td>
                    <!--<td>{{item.range}}</td>-->
                    <td ng-if="::item._horizontalTableHeader" class="horizontal has-treeline" colspan="5"
                        ng-include="'h-table.html'"></td>

                  </tr>
                  <!-- extra question -->
                  <tr ng-if="::!item._inHorizontalTable && needExtra(item)"
                      class="extra-row lf-form-table-row {{getRowClass(item)}} {{getSkipLogicClass(item)}} {{getActiveRowClass(item)}}" ng-if="targetShown(item)" ng-click="setActiveRow(item)">
                    <td class="name has-treeline">
                      <table class="t-treeline-field" >
                        <tr>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass($index, item._lastSiblingList)"
                              ng-repeat="lastStatus in item._lastSiblingList track by $index"> &nbsp; </td>
                          <td>
                            <div class="name-label">
                              <span>&nbsp;</span>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td class="button-col"></td>
                    <td colspan="5" class="extra-field">
                      <input ng-model="item.valueOther" placeholder="Please specify" ng-readonly="::item._readOnly">
                    </td>
                  </tr>
                  <!--a button row at the end of each repeating section-->
                  <tr ng-repeat-end ng-if="item._repeatingSectionList"
                      class="button-row lf-form-table-row {{getRowClass(item)}} {{getSkipLogicClass(item)}}" ng-if="targetShown(item)">
                    <td colspan="6" class="name has-treeline" >
                      <table class="t-treeline-field" >
                        <tr>
                          <td class="t-treeline " ng-class="getExtraRowTreeLevelClass($index, item._lastSiblingList)"
                              ng-repeat="lastStatus in item._lastSiblingList track by $index"> &nbsp; </td>
                          <td>
                            <div class="name-label">
                              <button ng-repeat="repeatingItem in item._repeatingSectionList"
                                      class="float-button" id="add-{{repeatingItem._elementId}}"
                                      ng-click="addOneRepeatingItem(repeatingItem)"
                                      title="Add another '{{ ::repeatingItem.question }}'">
                                Add another '{{::repeatingItem.question}}'</button>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </form>
  <button ng-if="debug" ng-click="onclick()">Click to debug Panel Controller</button>
</div>
